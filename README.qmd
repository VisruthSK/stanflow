---
title: stanflow
knitr:
  opts_chunk:
    collapse: true
    comment: '#>'
    fig.path: "man/figures/README-"
    out.width: "100%"
format: gfm
cache: true
---

<!-- badges: start -->
[![R-CMD-check](https://github.com/VisruthSK/stanflow/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/VisruthSK/stanflow/actions/workflows/R-CMD-check.yaml)
[![pkgdown](https://github.com/VisruthSK/stanflow/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/VisruthSK/stanflow/actions/workflows/pkgdown.yaml)
<!-- badges: end -->

```{r}
#| echo: false
#| comment: ""
stanflow::stanflow_logo()
```

`stanflow` offers an integrated, mildly opinionated access to a Stan-based [Bayesian Workflow](https://arxiv.org/abs/2011.01808) (Gelman et al. 2020). Much like the famous [tidyverse package](https://github.com/tidyverse/tidyverse), `stanflow` is a metapackage which installs and attaches relevant Stan R packages, serving as a one-stop-shop for Bayesian modelling.

`stanflow` draws heavy inspiration from the `tidyverse`, and reuses portions of its codebase--however, `stanflow` eschews `tidyverse` packages (i.e., `purrr`, `dplyr`, etc.) for base R implementations.

## Installation

You can install the development version of stanflow from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("VisruthSK/stanflow")
```
## Usage

Here, we load `stanflow` and decide to use `cmdstanr` as the backend for `brms`.

```{r}
library(stanflow)
setup_interface(
  interface = "brms",
  dev = FALSE,
  prefer_cmdstanr = TRUE,
  quiet = FALSE,
  force = FALSE,
  skip_setup = FALSE
)
set.seed(1234)
```

With these two commands (with the `setup_interface()` call being unnecessarily verbose), users have access to everything they need to fit and interrogate Bayesian models. Specifically, those two commands will load the core stanflow packages: `bayesplot`, `loo`, `posterior`, `projpred` and `shinystan`, as well as setup `brms` to use the `cmdstanr` backend with as many cores as are available on your machine. These package (inlcuding `brms` and `cmdstanr`) are all "`library()`d" as well, so we can proceed with our analysis immediately.

```{r}
cmdstanr_example()

fit1 <- brm(
  count ~ zAge + zBase * Trt + (1 | patient),
  data = epilepsy,
  family = poisson(),
  silent = TRUE,
  refresh = 0
)
summary(fit1)

plot(fit1, variable = c("b_Trt1", "b_zBase"))

fit2 <- brm(
  count ~ zAge + zBase * Trt + (1 | patient) + (1 | obs),
  data = epilepsy,
  family = poisson(),
  silent = TRUE,
  refresh = 0
)
summary(fit2)

loo(fit1, fit2)
```

Code snippets above are taken from the [`brms` README](https://paulbuerkner.com/brms/) but aren't directly comparable.
